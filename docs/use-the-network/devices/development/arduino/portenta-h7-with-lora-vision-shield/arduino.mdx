---
id: arduino
hide_title: true
sidebar_label: Arduino
slug: /use-the-network/devices/development/arduino/portenta-h7-with-lora-vision-shield/arduino
---

import useBaseUrl from "@docusaurus/useBaseUrl";

## Arduino Portenta H7 with the LoRa Vision Shield

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

## Introduction to Guide

:::important

Before we begin, please make sure you've followed the steps from the Console
quickstart [here](/use-the-network/console/quickstart).

:::

## Objective and Requirements

In this guide, you will learn:

- How to setup your environment
- How to program a basic application that will send packets over the Helium
  Network
- Verify real-time packets sent to the Helium Console via Hotspot that's in
  range

For this example, you will need the following:

### Hardware

- [Portenta H7](https://store-usa.arduino.cc/products/portenta-h7)
- [LoRa Vision Shield](https://store-usa.arduino.cc/products/arduino-portenta-vision-shield-lora%C2%AE)
- Micro USB Type B Cable -
  [Example](https://www.amazon.com/AmazonBasics-Male-Micro-Cable-Black/dp/B0719H12WD/ref=sr_1_2_sspa?)
- U.FL connector for your region. this example will use the US915MHz Antenna 
  [Example: U.FL IPEX to SMA Connector Antenna 915MHz for Lora Board](https://www.amazon.com/DIYmall-Connector-Antenna-915MHz-Lora32u4/dp/B084KVYBH5)
  
### Software

- [Arduino software \(IDE\)](https://www.arduino.cc/en/Main/Software) Old stable version ~Arduino IDE 1.8.19 or new version ~2.0.0RC3  
- [Helium Console](https://console.helium.com/)

## Hardware Setup

This step will cover adding an antenna to the LoRa Vision Shield.

### Adding the Antenna

The uFL connector is just a push fit on the LoRa board, not the main Portenta board (That uFL connector is for WiFi and BLE). 
Try not to have to remove and replace the antenna very often. the uFL connectors are rated for 30 connection cycles, so be careful when connecting/disconnecting to not rip the pads off the PCB


## Software Setup

### Getting the Arduino IDE

Download and install the latest version of
[Arduino IDE](https://www.arduino.cc/en/Main/Software) for your preferred OS.

- [Windows](https://www.arduino.cc/en/Guide/Windows)
- [Linux](https://www.arduino.cc/en/Guide/Linux)
- [Mac OSX](https://www.arduino.cc/en/Guide/MacOSX)

### Arduino Board Support

The Portenta H7 requires one Arduino board support package. Follow the
instructions below to install it.

#### Arduino Mbed OS Portenta Boards 

To install, open your Arduino IDE:

1. Navigate to \(**Tools &gt; Boards &gt; Boards Manager...\)**
2. Search for **Arduino Mbed OS Portenta Boards**
3. Select the newest version and click Install


<img
  src={useBaseUrl(
    "img/use-the-network/devices/development/arduino/portenta/mbed-board-install.png"
  )}
/>



### Arduino Library #1 MKRWAN

To communicate with Helium's LoRaWAN network, we'll need to install an Arduino
library.

To install, open your Arduino IDE:

1. Navigate to Library Manager \(**Sketch &gt; Include Library &gt; Manage
   Libraries**\).
2. In the search box, type **MKRWAN** into the search, select the **MKRWAN** library latest
   version see image below, and click Install.

<img
  src={useBaseUrl(
    "img/use-the-network/devices/development/arduino/portenta/mkrwan.png"
  )}
/>

If you prefer to install the zipped latest file from the github click [MKRWAN](https://github.com/arduino-libraries/MKRWAN) download the zipped file then find the library menu item to install zipped libraries





### Arduino Library #2 portenta-pro-community-solutions

To communicate with Helium's LoRaWAN network, we'll need to install an Arduino
library.

To install, open your Arduino IDE:

1. Navigate to Library Manager \(**Sketch &gt; Include Library &gt; Manage
   Libraries**\).
2. In the search box, type **community** into the search, select the **portenta-pro-community-solutions** library latest
   version see image below, and click Install.

<img
  src={useBaseUrl(
    "img/use-the-network/devices/development/arduino/portenta/portenta-pro-community-solutions-library-install.png"
  )}
/>

If you prefer to install the zipped latest file from the github click [portenta-pro-community-solutions](https://github.com/hpssjellis/portenta-pro-community-solutions) download the zipped file then find the library menu item to install zipped libraries


### MKRWAN reprogram LoRa board using the MKRWAN example sketch
MKRWANFWUpdate_standalone make sure you run the serial monitor to fully update the LoRa module with the correct program.

<img
  src={useBaseUrl(
    "img/use-the-network/devices/development/arduino/portenta/mkrwanFWUpdate_standalone-image.png"
  )}
/>


### Upload Sketch

We're finally ready to upload our sketch to the board. In the Arduino IDE, click
the right arrow button, or navigate to \(**Sketch &gt; Upload\),** to build and
upload your new firmware to the board. You should see something similar to the
image below at the bottom of your Arduino IDE, when the upload is successful.

<img
  src={useBaseUrl(
    "img/use-the-network/devices/development/arduino/portenta/upload-success.png"
  )}
/>

### Viewing Serial Output

When your firmware update completes, the board will reset, and begin by joining
the network. Let's use the Serial Monitor in the Arduino IDE to view the output
from the board. We first need to select the serial port again, but this time it
will be a **different port** than the one we selected to communicate with the
bootloader. Once again, navigate to \(**Tools &gt; Port: Arduino Portenta**\), but make sure the serial device, either COM\# or ttyACM\#, is different!
Next navigate to \(**Tools &gt; Serial Monitor**\), you should begin to see
output similar to below.

<img
  src={useBaseUrl(
    "img/use-the-network/devices/development/arduino/portenta/serial-monitor-output.png"
  )}
/>



### Programming Example Sketch

Now that we have the required Arduino board support and library installed, lets
program the board with the provided example sketch.

To create a new Arduino sketch, open your Arduino IDE, \(**File &gt; New\).**
Next, replace the template sketch with the sketch found
[here](https://github.com/hpssjellis/portenta-pro-community-solutions/blob/main/examples/dot3-portenta-vision-shields/dot33-lorawan-specific/dot334-proof-us915-helium-connect.ino),
copy and paste the entirety of it or if you have the Portenta-pro-community-solutions library just find example dot334-proof-us915-helium-connect.ino

Next we'll need to fill in the SECRET_APP_EUI\(lsb\), and SECRET_APP_KEY\(msb\), written exactly as you see them from the [Helium Console](https://console.helium.com/)
Note: On these boards the deviceEUI is fixed per board, so you will have to run the code once, view in the serial monitor what your boards deviceEUI is and enter that in the Helium Console. (the Helium console will randomly give you a deviceEUI (the top one in the list) but you must reset it)


<img
  src={useBaseUrl(
    "img/use-the-network/devices/development/arduino/portenta/helium-console-keys.png"
  )}
/>


### Selecting Board

Next, we need to select the correct board to build for in the Arduino IDE.
Navigate to \(**Select Tools &gt; Board: &gt; Arduino Mbed OS Portenta Boards &gt; Arduino Portenta H7 \(M7 Core\) \).**


### Enter Bootloader Mode

Next, we need to place the board into bootloader mode, which allows us to update
it with new firmware. To do this, first plug the device into your computer, make
sure the board is getting power \(you should see a green LED on\). Next,
quickly double click the reset push button on the top side of the board, you
should see the green LED slowly blink about one blink per second. If you see this then you have successfully
entered bootloader mode.

### Selecting Port

We're almost ready to upload our sketch, the very last step is to select the
correct Serial port in the Arduino IDE. Navigate to \(**Tools &gt; Port:
Arduino Portenta**\). You will also see either **COM\# or /dev/ttyACM\#**
depending on whether you are on Windows, Mac, or Linux. If you do not see a
port, you will need to check if the Arduino drivers have been installed.

<img
  src={useBaseUrl(
    "img/use-the-network/devices/development/arduino/portenta/fixed-dev-eui.png"
  )}
/>


Now let's head back to [Helium Console](https://console.helium.com) and look at
our device page, you should see something similar to the screenshot below.

<img
  src={useBaseUrl(
    "img/use-the-network/devices/development/arduino/portenta/helium-debug.png"
  )}
/>

Congratulations! You have just transmitted data on the Helium network! The next
step is to learn how to use your device data to build applications, visit our
Integrations docs [here](/use-the-network/console/integrations).

